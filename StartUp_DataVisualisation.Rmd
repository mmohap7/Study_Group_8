---
title: "StartUp_DataVisualisation"
author: "Study Group 8"
date: "`r Sys.Date()`"
output:
  html_document:
    number_sections: yes
    highlight: haddock
    theme: spacelab
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: no
    fontzize: 10pt
  pdf_document:
    toc: yes
    toc_depth: '2'
  word_document:
    toc: yes
    toc_depth: '2'
---

# Introduction
What predicts start-up success? As six entrepreneurial-minded students from LBS, we wanted to understand better how start-up success can be predicted. Which industry receive higher funding and which locations contribute to a higher probability of being acquired?
We would love to start our own venture in the US and find out more about trends in the start-up world there and how will can increases our chances of being successful.

In order to find out what we should do and how we should get there we will look into different aspects of our new venture called.
Firstly, we will investigate the category...
Secondly, we will look at location
Lastly, at time and when we should plan to reach our first milestones and secure funding rounds. 
In the end we will use the insights gained from this and build a prediction model for our venture

##### Notes
Notes
- category: what is the most successful category? JUN, MELONICA
- location: where: map: Draw a startups map, identifying the next Silicon Valley. RICK, MEHDI
    Idea Josi: Maybe we can also compare it to population ? Startups per population?
- time PEIJUN, JOSI
    when do we have to reach our milestones
    when do we have to our first/second/third funding round as well as funding amount
    
=> Build a model with it, to get highest success in start-up world in the US

Overall theme & color scheme: 

The goal of this report is to   
  - Trace the startups funding trend in recent years.
  - Draw a startups map, identifying the next Silicon Valley.
  - Utilise data modelling to select the features that might influence startups funding and outcomes.
  - Predict a startup's future based on its current characteristics.
  - Bring out customised advise to startups according to their segmentation.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(mice) 
library(VIM)
library(dplyr)
library(Hmisc)
library(janitor)
library(here)
library(skimr)
library(rsample)
library(readr)
library(sf)
remotes::install_github("UrbanInstitute/urbnmapr")
library(urbnmapr)
library(kableExtra)
library(patchwork)
library(scales)
```
<style>
div.navy1 { background-color:#686868; border-radius: 5px; padding: 20px; border-style: groove; color: #ffffff;}

</style>

```{r setup2, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data loading
We have loaded the data from Kaggle !("https://www.kaggle.com/manishkc06/startup-success-prediction").

```{r clean data}
startup_data <- read_csv("data/startup data.csv") 
```
## Inspect the data
Here we have inspected the data. The data contains a lot of columns that has already defined dummy variables for a potential regression analysis.
```{r}

#View the first couple of rows with all the columns
glimpse(startup_data)

#Use the skim function to check the variables for missing values and distribution
skim(startup_data)

# add to new data frame to process and clean the data
startup_data_process <- startup_data
```

# Data cleaning

After skimming the data to get a good overview, we have cleaned the data. To make the data technically correct we have checked the data, cleaned the column names, has no duplicate or empty rows and make sure the columns represent the right type.

```{r clean names}
# clean names
startup_data_process <- clean_names(startup_data_process)  

```

## Duplicates
```{r,echo=FALSE}
# remove empty columns and rows
startup_data_process <- remove_empty(startup_data_process, which = c("rows","cols"))

# check for duplicates
dupes <- startup_data_process %>% 
  get_dupes(object_id)

dupes
```

There is one duplicate for the start-up "Redwood Systems", which have slightly different coordinates. Perhaps, they have moved locations but since they are both in California and still have the same zip code we have removed the row that does not have an exact address. 

```{r remove duplicate}
# removing the duplicate row
startup_data_process <- startup_data_process[ !(startup_data_process$unnamed_0 == 505), ]

# checking if there still are duplicates
dupes <- startup_data_process %>% 
  get_dupes(object_id)

dupes

```

## Data types
Next, we will look at the data types. The dates still have to be put into the correct data type

Other ones as well?

```{r date data type}
# converting the dates into data format
startup_data_process <- startup_data_process %>%
  mutate(founded_at = mdy(founded_at), 
         closed_at = mdy(closed_at), 
         first_funding_at = mdy(first_funding_at), 
         last_funding_at = mdy(last_funding_at))
```

## Create new variables 
Further in this report we need additional variables for visualisations. Also, we have made sure the variables are of the right type 
create age in year
create year founded (extract from day)
create area variable (West coast, East Cost etc)
create
```{r}
 
# create year founded  
startup_data_process <- startup_data_process %>% 
  mutate(year_founded = year(founded_at))
```

```{r}
# make a new category variables -> maybe use top 6 and rest into others 
startup_data_process <- startup_data_process %>% 
  mutate(category1 = ifelse ((category_code != 'software' & 
                                category_code!= 'web' & 
                                category_code != 'mobile' & 
                                category_code != 'enterprise' & 
                                category_code != 'advertising' & 
                                category_code != 'games_video' & 
                                category_code != 'ecommerce' & 
                                category_code != 'biotech' & 
                                category_code != 'consulting'), 
                             'other_category', 
                             startup_data_process$category_code))
```

```{r}
startup_data_process <- startup_data_process %>% 
  mutate(category2 = ifelse ((category_code != 'software' & 
                                category_code!= 'web' & 
                                category_code != 'mobile' & 
                                category_code != 'advertising' & 
                                category_code != 'games_video' & 
                                category_code != 'ecommerce' ), 
                             'other_category', 
                             startup_data_process$category_code))
```

After making the data technically correct, we have made sure the data is consistent. We checked the variables for missing variables and made sensible decisions to what to do with the missing data. In the EDA we checked the variables even further and adjusted for extreme outliers.

## Missing data

```{r}
# investigate the missing values
describe(startup_data_process)    

#  use the md.pattern function from MICE package
md.pattern(startup_data_process, rotate.names = T)
```

There are some missing values for 
- Unnamed_6: this is a more detailed address, we will delete this column
- closed_at 
- age_first_milestone_year 
- age_last_milestone_year
- state_code.1

We decided to remove the unnamed_6 column because it did not add anything to the research, as it is just a combination of zip code and state. Closed_at remains to have NA values, as an acquired company has no close date. The missing milestone years are explained by startups not having milestones, so we left the NA values here. We replaced the 1 NA for state code to CA, because this company was established here.

```{r missing values}
# delete unnamed_6
startup_data_process <- startup_data_process %>%
  select(-unnamed_6)

# cross-check if closed_at only occurs for start-ups that are not acquired
check_closedat <- startup_data_process %>%
  filter(is.na(closed_at) & status == "closed")
# this is the case, so we will leave na here

# cross-check if milestone values are missing if there have not been any milestones
check_milestones <- startup_data_process %>%
  filter((is.na(age_first_milestone_year) & milestones != 0) | # or
           (is.na(age_last_milestone_year) & milestones != 0))
# this is the case, so we will leave na here

# replace the missing state, which is CA (after research)
startup_data_process$state_code_1 <- ifelse(is.na(startup_data_process$state_code_1), 'CA', startup_data_process$state_code_1)
```


After the data cleaning we will assign it back to the original data set and then start our exploratory data analysis. We will treat any outliers as we go through the EDA.
```{r}
# assign the cleaned data back to the original data set so that we can work
startup_data <- startup_data_process
```


# Exploratory data analaysis

## Check numerical variables
We checked the numerical variables on outliers and wrong data. For this we look at the describe and skim function used above.

### Funding Amount
First, we looked into the distribution of the funding amount. It is highly right-skewed, which is why we take the log
```{r}

#Create a boxplot for the total funding
startup_data %>% 
  ggplot(aes(
    x = funding_total_usd
  )) +
    geom_boxplot()+
  coord_flip()

startup_data %>% 
  ggplot(aes(
    x = funding_total_usd
  )) +
    geom_histogram() 

startup_data %>% 
  ggplot(aes(
    x = log(funding_total_usd)
  )) +
    geom_boxplot() +
    coord_flip()

startup_data %>% 
  ggplot(aes(
    x = log(funding_total_usd)
  )) +
    geom_histogram()

```


```{r}
startup_data %>% 
  arrange(desc(funding_total_usd)) %>% 
  head(10)

startup_data_process %>% 
  arrange(funding_total_usd) %>% 
  head(10)
```
Looking at the funding total, there are some outliers. These do not seem unjustified, so we will not do anything with them here.

### Funding rounds
```{r}
# startups according to funding round
startup_data %>% 
  group_by(funding_rounds) %>% 
  summarise(count_funding=n())
```


### Age (funding & milestones)

```{r}
startup_data %>% 
  ggplot(aes(
    x = age_first_funding_year,
    colour = status
  )) +
  geom_density()

startup_data %>% 
  ggplot(aes(
    x = age_last_funding_year,
    colour = status
  )) +
  geom_density()

startup_data %>% 
  ggplot(aes(
    x = age_first_milestone_year,
    colour = status
  )) +
  geom_density()

startup_data %>% 
  ggplot(aes(
    x = age_last_milestone_year,
    colour = status
  )) +
  geom_density()
```

```{r}
startup_data %>% 
  ggplot(aes(
    x = milestones,
    fill = status
  )) +
  geom_bar()

startup_data %>% 
  ggplot(aes(
    x = funding_rounds,
    fill = status
  )) +
  geom_bar()

```


## Check categorical variables
-> Names and distributions of categorical values.
For the categorical variables, we looked into the sectors:

# Categories
```{r EDA sectors}
startup_data %>%
  group_by(category_code) %>% 
  summarise(count_category = n()) %>%
  arrange(desc(count_category))

# we have 35 categories of startups  with the highest number of startups in software

startup_data %>%
  group_by(category_code) %>% 
  summarise(count = n()) %>% 
  ggplot(aes(
    x = reorder(category_code, count),
    y = count
  )) +
  geom_col() +
  coord_flip() +
  labs(
    x = "startup category",
    y = "number of startups"
  )

startup_data %>% 
  group_by(category_code, status) %>% 
  summarise(count = n()) %>% 
  ggplot(aes(
    x = reorder(category_code, count),
    y = count,
    fill = reorder(status, desc(status))
  )) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values = c("#FF3333", "#00CC66")) +
  labs(fill = "start up status",
       x = "category")

```

### States and Location
Next, we will look at the locations of the start-ups.
Start-ups are located in 35 different states, with most of them being in California
```{r}
# look at the start-ups per state
startup_data %>% 
  group_by(state_code_1) %>%
  summarise(count_state = n()) %>%
  arrange(desc(count_state))

# we have 35 states with startups with highest number of startups in California
```


```{r }

library(sf)
remotes::install_github("UrbanInstitute/urbnmapr")
library(urbnmapr)

counties_sf <- get_urbn_map("counties", sf = TRUE)

counties_sf

class(counties_sf)
counties_sf$geometry

counties_sf <- counties_sf %>% 
st_transform(4326)

counties_sf %>% 
  ggplot(aes()) +
  geom_sf(fill = "grey70", colour = "#ffffff") +
  geom_point(data = startup_data, aes(
    x = longitude,
    y = latitude
  ))

startup_data %>% 
  filter(longitude > -20)

num_by_state <- startup_data %>% 
  group_by(state_code) %>% 
  summarise(count = n())

counties_sf_heat <- counties_sf %>% 
  left_join(num_by_state, by = c("state_abbv" = "state_code"))

counties_sf_heat %>% 
  ggplot(aes()) +
  geom_sf(aes(fill = count)) +
  scale_fill_gradient(low = "blue", high = "#98ff98")

```


```{r, echo=FALSE}

head(startup_data)

library(mosaic)
library(ggfortify)
library(moderndive)
library(janitor)
library(huxtable)
library(here)
library(broom)
library(skimr)
library(GGally)
library(car)
library(vroom)
library(GGally)
library(leaflet)


#Removing the 4 outliers located in the uK and in Sweden
startup_data_clean<- startup_data%>%
  filter(longitude < -10 )


#making the interactive map in the U.S
startup_data_clean %>% 
leaflet() %>% 
  addProviderTiles("OpenStreetMap.Mapnik") %>% 
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude, 
                   radius = 1,
                   fillOpacity = 0.4, 
                   popup = ~state_code,
                   label = ~category_code,
                   #to get a better overview of the number start-ups in the US a clustered map was chosen instead of the original point mapping.
                   clusterOptions = markerClusterOptions()
                  )
  
```
# Visualisations

## Category -> Melonica, Jun
We explore a few variables by category to see if there are certain criteria we could utilize to determine which categories of startups are more likely to get funded, get acquired and develop into a large-scale company.

```{r}
# Average amount of funding raised per category
head(startup_data_process)
startups_per_category_funding <- startup_data_process %>% group_by(category_code) %>% summarise(average_funding_amount = mean(funding_total_usd)) 
startups_per_category_funding%>% group_by(category_code) %>% select(average_funding_amount)%>%arrange(desc(average_funding_amount))%>%head(10)

# No. of funding rounds per category 
startups_per_category <- startup_data_process %>% group_by(category_code) %>% summarise(average_funding_rounds = mean(funding_rounds)) 
startups_per_category%>% group_by(category_code) %>% select(average_funding_rounds)%>%arrange(desc(average_funding_rounds))%>%head(10)

# No. of milestones per category
startups_per_category <- startup_data_process %>% group_by(category_code) %>% summarise(average_milestones = mean(milestones)) 
startups_per_category%>% group_by(category_code) %>% select(average_milestones)%>%arrange(desc(average_milestones))%>%head(10)

# no. of startups in the 'top 500' list
startups_per_category_500 <- startup_data_process %>% group_by(category_code) %>% summarise(in_top_500 = sum(is_top500)) 
startups_per_category_500%>% group_by(category_code) %>% select(in_top_500)%>%arrange(desc(in_top_500))%>%head(10)

# startup failure rate by category
 startup_failure_rate <- startup_data_process %>% group_by(category_code)%>%summarise(total_acquired= sum(status=='acquired'), total_not_acquired = sum(status=='closed'))
 startup_failure_rate %>% group_by(category_code) %>% arrange(desc(total_acquired))%>%head(10)
 
# CHART FOR BEING FUNDED BY ROUNDS
 startups_acc_rounds <- startup_data_process%>% group_by(category_code)%>%summarise(round_A = sum(has_round_a), round_B=sum(has_round_b), round_C=sum(has_round_c), round_D = sum(has_round_d))
 startups_acc_rounds
 
 startups_per_category_tot_fund <- startup_data_process %>% group_by(category_code) %>% summarise(total_funding_rounds = sum(funding_rounds)) 
startups_per_category_tot_fund%>% group_by(category_code) %>% select(total_funding_rounds)%>%arrange(desc(total_funding_rounds))%>%head(10)


```


```{r}
# Average amount of funding raised per category
funding_average <- startup_data_process %>%
  group_by(category_code) %>%
  summarise(average_funding = (mean(funding_total_usd))/1000000)%>%arrange(desc(average_funding))%>%head(10)

funding_average_plot <- funding_average %>% 
  ggplot(aes(x = average_funding, 
             y = reorder(category_code, 
                         average_funding), 
             fill = category_code)) +
  geom_bar(stat="identity",fill="#1f6e8c") + 
  labs(title = "Mobile startups attract the most funding",
    subtitle = "Average Funding by Category",
       x = "Average Funding(in Millions)",
      y="") + 
  scale_fill_manual(values=c("#1f6e8c"))+
  theme(axis.title.y = element_blank())+
  theme_minimal()+
  NULL

funding_average_plot


# no. of startups in the 'top 500' list
startups_per_category_500 <- startup_data_process %>% group_by(category_code) %>% summarise(in_top_500 = sum(is_top500)) %>%arrange(desc(in_top_500))%>%head(10)


topp500_plot <- startups_per_category_500 %>% 
  ggplot(aes(x = in_top_500, 
             y = reorder(category_code, 
                         in_top_500), 
             fill = category_code)) +
  geom_bar(stat="identity",fill="#4aaec0") + 
  labs(title = "Software startups are the most represented in Top 500 List",
       subtitle = "Companies in Top 500 by Category",
       x = "Number of companies",
       y="") + 
  scale_fill_manual(values=c("#4aaec0"))+
  theme(axis.title.y = element_blank())+
  theme_minimal()+
  NULL

topp500_plot


success_rate <- startup_data %>% 
  group_by(category2, status) %>% 
  summarise(count = n())

success_rate_plot <- success_rate %>% ggplot(aes(
    y = count/sum(count)*1000,
  x = category2,
    fill = reorder(status, desc(status))
  )) +
  geom_col(position="fill") +
  coord_flip() +
  scale_fill_manual(values = c("#a5a8b6", "#649c23")) +
  labs(fill = "Status",
       x="",
  y="Success Rate",
  title = "Advertising startups have the highest chance to succeed",
       subtitle = "Startup Success Rate by Category") + 
  theme(axis.title.x = element_blank())+
#geom_text(aes(x=category2,label = ratio), position = position_fill(vjust = 0.5))+
  theme_minimal()+
  NULL
success_rate_plot

```





## Location -> Rick, Mehdi
make startups map, identifying the next Silicon Valley.
maybe look at funding per state / success rate per state
startups per population

## Age: When should we aim to reach milestones and funding rounds? 

Lastly, we want to get an idea of when we should aim to complete milestones as well as funding rounds.

Overall, we try to answer the following two questions:
- When do we have to reach our first (and last) milestones?
- When do we have to reach our first (and last) funding round?
```{r}
startup_data <- startup_data %>%
  filter(age_first_milestone_year>(-(6/12)))
startup_data
```

### Milestone
```{r setup milestones}
# find the average age for the first milestones for successful and unsuccessful companies
means_first_milestone <- startup_data %>%
  group_by(status) %>%
  summarise(means = mean(age_first_milestone_year, na.rm = TRUE))

# extract the values
means_first_milestone_acquired <- means_first_milestone$means[1]
means_first_milestone_closed <- means_first_milestone$means[2]

# find the average age for the last milestones for successful and unsuccessful companies
means_last_milestone <- startup_data %>%
  group_by(status) %>%
  summarise(means = mean(age_last_milestone_year, na.rm = TRUE))

# extract the values
means_last_milestone_acquired <- means_last_milestone$means[1]
means_last_milestone_closed <- means_last_milestone$means[2]

# define categories names for plots (do at beginning @Rick ?)
categories_names <- c("Advertising", "E-Commerce", "Games & Video", "Mobile", "Other", "Software", "Web")
names(categories_names) <- c("advertising", "ecommerce", "games_video", "mobile", "other", "software", "web")
```

```{r plots milestones}  
# create plot for first milestones
plot_time1 <- startup_data %>%
  filter(category2 != "other_category") %>%
  ggplot(aes(x = age_first_milestone_year, fill = status)) +
  geom_density(alpha = 0.5, color = "grey") +
  geom_vline(aes(xintercept = means_first_milestone_acquired),   
               color = "#4aaec0", linetype = "dotted", size = 0.5) +  
  geom_vline(aes(xintercept = means_first_milestone_closed), 
               color = "#ff5828", linetype = "dotted", size = 0.5) +  
  facet_wrap(~category2, ncol = 2, scales = "free_y", labeller = labeller(category2 = categories_names)) +
  scale_x_continuous(limits = c(-2, 10)) +
  scale_color_manual(values = c("#4aaec0", "#ff5828")) +
  scale_fill_manual(values = c("#4aaec0", "#ff5828"), name = "Status", labels = c("Aquired (mean age 3.52)", "Closed (mean age 2.57)")) +  
  theme_minimal() +
  labs(title = "Successful start-ups reach their first milestones later in most industries",
       subtitle = "Distribution of age when reaching first milestone",
       y = "",
       x = "Age of start-ups when reaching their first milestones") +
  NULL

plot_time1

# create plot for last milestones (not in presentation)
plot_time2 <- startup_data %>%
  filter(category2 != "other_category") %>%
  ggplot(aes(x = age_last_milestone_year, fill = status), legend.position=FALSE) +
  geom_density(alpha = 0.5, color = "grey") +
  geom_vline(aes(xintercept = means_last_milestone_acquired),   
               color = "#4aaec0", linetype = "dotted", size = 0.5) +  
  geom_vline(aes(xintercept = means_last_milestone_closed),   
               color = "#ff5828", linetype = "dotted", size = 0.5) +  
  facet_wrap(~category2, ncol = 2, scales = "free_y", labeller = labeller(category2 = categories_names)) +
  scale_x_continuous(limits = c(-2, 15)) +
 scale_color_manual(values = c("#4aaec0", "#ff5828")) +
  scale_fill_manual(values = c("#4aaec0", "#ff5828"), name = "Status", labels = c("Aquired (mean age 5.38)", "Closed (mean age 3.58)")) +
  theme_minimal() +
  labs(title = "Successful start-ups reach their last milestones later in most industries",
       subtitle = "Distribution of age when reaching first milestone",
       y = "",
       x = "Age of start-ups when reaching last milestones") +
  NULL

 plot_time2
```

From the graphs it looks like that for most categories, companies that were closed reached their first milestone before those that were acquired. The only exception is the software category. 
We conduct a t-test to understand the following question: 
Do successful start-ups reach their first milestone earlier than unsuccessful ones?


```{r boxplot for t-test}
# boxplot to visualise
milestone_plot <- ggplot(startup_data, aes(y = status, x = (age_first_milestone_year))) +
  geom_boxplot(aes(color = status), width = 0.3, show.legend = FALSE) +
  geom_jitter(aes(color = status), alpha = 0.5, show.legend = FALSE, position = position_jitter(width = 0.2, seed = 0)) +
  scale_color_manual(values = c("#4aaec0", "#ff5828")) +
  theme_minimal() +
  labs(title = "Which start-ups reach their first milestone first?",
       subtitle = "Age of start-ups when reaching their first milestones",
       y = "Status",
       x = "Age of first milestone")

milestone_plot
```

```{r t-test first_ms}
# conduct the t-test
test_ms_first <- t.test(age_first_milestone_year ~ status, 
        data = startup_data) 

test_ms_first

test_ms_first_tidy <- tidy(test_ms_first) %>% 
  # calculate the difference in means
  mutate(estimate = estimate1 - estimate2) %>%
  # rearrange columns
  select(starts_with("estimate"), everything())

test_ms_first_tidy
```

```{r t-test last_ms}
# conduct the t-test
test_ms_last <- t.test(age_last_milestone_year ~ status, 
        data = startup_data) 

test_ms_last

test_ms_last_tidy <- tidy(test_ms_last) %>% 
  # calculate the difference in means
  mutate(estimate = estimate1 - estimate2) %>%
  # Rrarrange columns
  select(starts_with("estimate"), everything())

test_ms_last_tidy
```

The test shows that there is a significant difference for the first funding year between successful and unsuccessful start-ups. We can reject the null hypothesis at the 2% level.
The same confirms for reaching the last milestones

Hence, successful start-ups usually reach their first milestone later. Thus, for our start-up, we will aim not to rush reaching our first milestone and will take its time.

So, when do we have to reach our first milestone?
On average we should reach our first milestone after 3.362

However, since we defined before that we would like to go into the mobile industry, we will look at the mean there as well for first and last mile stones:
```{r}
ideal_category <- "mobile"

means_first_milestone_category <- startup_data %>%
  filter(category2 == ideal_category) %>% # depending on which industry we want to go in 
  group_by(category2, status) %>%
  summarise(means_category = mean(age_first_milestone_year, na.rm = TRUE),
            sd_category = sd(age_first_milestone_year, na.rm = TRUE)) %>%
  arrange(desc(means_category))

means_first_milestone_category

means_last_milestone_category <- startup_data %>%
  filter(category2 == ideal_category) %>% # depending on which industry we want to go in 
  group_by(category2, status) %>%
  summarise(means_category = mean(age_last_milestone_year, na.rm = TRUE),
            sd_category = sd(age_last_milestone_year, na.rm = TRUE)) %>%
  arrange(desc(means_category))

means_last_milestone_category

ideal_first_milestone_age <- means_first_milestone_category$means_category[1]  
ideal_last_milestone_age <- means_last_milestone_category$means_category[1] 

print(paste0("Target age for our first milestone: ", round(ideal_first_milestone_age, 2), " years"))
print(paste0("Target age for our last milestone: ", round(ideal_last_milestone_age, 2), " years"))

```




### Funding
After looking at the target age for milestones, we also look at the target age for different funding rounds. 
```{r setup funding}
# find the average age for the first funding for successful and unsuccessful companies
means_first_funding <- startup_data %>%
  group_by(status) %>%
  summarise(means = mean(age_first_funding_year, na.rm = TRUE))

# extract the values
means_first_funding_acquired <- means_first_funding$means[1]
means_first_funding_closed <- means_first_funding$means[2]

# find the average age for the last milestones for successful and unsuccessful companies
means_last_funding <- startup_data %>%
  group_by(status) %>%
  summarise(means = mean(age_last_funding_year, na.rm = TRUE))

# extract the values
means_last_funding_acquired <- means_last_funding$means[1]
means_last_funding_closed <- means_last_funding$means[2]
```

```{r first funding}
# same thing as above
plot_time3 <- startup_data %>%
  filter(category2 != "other_category") %>%
  ggplot(aes(x = age_first_funding_year, fill = status)) +
  geom_density(alpha = 0.5, color = "grey") +
  geom_vline(aes(xintercept = means_first_funding_acquired), 
               color = "#4aaec0", linetype = "dotted", size = 0.5) +  
  geom_vline(aes(xintercept = means_first_funding_closed), 
               color = "#ff5828", linetype = "dotted", size = 0.5) +  
  facet_wrap(~category2, ncol = 2, scales = "free_y", labeller = labeller(category2 = categories_names)) +
  scale_x_continuous(limits = c(-2, 10)) +
  scale_color_manual(values = c("#4aaec0", "#ff5828")) +
  scale_fill_manual(values = c("#4aaec0", "#ff5828"), name = "Status", labels = c("Aquired (mean age 2.00)", "Closed (mean age 2.21)")) +
  theme_minimal() +
  labs(title = "Successful start-ups reach their first funding later in most industries",
       subtitle = "Age of start-ups when reaching their first funding",
       y = "",
       x = "Age when reaching first funding") +
  NULL

plot_time3


# plot last funding age
plot_time4 <- startup_data %>%
  filter(category2 != "other_category") %>%
  ggplot(aes(x = age_last_funding_year,fill = status)) +
  geom_density(alpha = 0.5, color = "grey") +
  geom_vline(aes(xintercept = means_last_funding_acquired),  #check this again please 
               color = "#4aaec0", linetype = "dotted", size = 0.5) +  
  geom_vline(aes(xintercept = means_last_funding_closed),  #check this again please 
               color = "#ff5828", linetype = "dotted", size = 0.5) +  
  facet_wrap(~category2, ncol = 2, scales = "free_y", labeller = labeller(category2 = categories_names)) +
  scale_x_continuous(limits = c(-2, 15)) +
  scale_color_manual(values = c("#4aaec0", "#ff5828")) +
  scale_fill_manual(values = c("#4aaec0", "#ff5828"), name = "Status", labels = c("Aquired (mean age 4.03)", "Closed (mean age 3.45)")) +
  theme_minimal() +
  labs(title = "Successful start-ups reach their last funding later in most industries",
       subtitle = "Age of start-ups when reaching their last funding",
       y = "",
       x = "Age of last funding") +
  NULL

 plot_time4
```


```{r t-test first funding}
test_fg_first <- t.test(age_first_funding_year ~ status, 
        data = startup_data) 
test_fg_first

test_fg_first_tidy <- tidy(test_fg_first) %>% 
  # Calculate difference in means, since t.test() doesn't actually do that
  mutate(estimate = estimate1 - estimate2) %>%
  # Rearrange columns
  select(starts_with("estimate"), everything())

test_fg_first_tidy
```

```{r t-test last funding}
test_fg_last <- t.test(age_last_funding_year ~ status, 
        data = startup_data) 
test_fg_last

test_fg_last_tidy <- tidy(test_fg_last) %>% 
  # Calculate difference in means, since t.test() doesn't actually do that
  mutate(estimate = estimate1 - estimate2) %>%
  # Rearrange columns
  select(starts_with("estimate"), everything())

test_fg_last_tidy
```

However, at the 2%, there is no difference in age for the first funding between successful and unsuccessful start-ups. The same occurs for the last funding round age.

Based on this, we will just take the average funding
```{r}
ideal_category <- "mobile"

means_first_funding_category <- startup_data %>%
  filter(category2 == ideal_category) %>% # depending on which industry we want to go in 
  summarise(means_category = mean(age_first_funding_year, na.rm = TRUE),
            sd_category = sd(age_first_funding_year, na.rm = TRUE)) %>%
  arrange(desc(means_category))

means_first_funding_category

means_last_funding_category <- startup_data %>%
  filter(category2 == ideal_category) %>% # depending on which industry we want to go in 
  summarise(means_category = mean(age_last_funding_year, na.rm = TRUE),
            sd_category = sd(age_last_funding_year, na.rm = TRUE)) %>%
  arrange(desc(means_category))

means_last_funding_category

ideal_first_funding_age <- means_first_funding_category$means_category[1]  
ideal_last_funding_age <- means_last_funding_category$means_category[1] 

print(paste0("Target age for our first funding: ", round(ideal_first_funding_age, 2), " years"))
print(paste0("Target age for our last funding: ", round(ideal_last_funding_age, 2), " years"))
```


### Timeline
With all these insights gained, we will now create a basic overview for our milestones and funding rounds that we are aiming to reach with our start-up.

```{r}
# create a new dataframe with the dates, assuming we will start our start-up today
date_founded_at <- today ()
date_first_funding <- today() + ideal_first_funding_age * 365
date_last_funding <- today() + ideal_last_funding_age * 365
date_first_milestone <- today() + ideal_first_milestone_age * 365
date_last_milestone <- today() + ideal_last_milestone_age * 365

milestone <- c("Foundation", "First funding", "Last funding", "First milestone", "Last milestone")
date <- c(date_founded_at, date_first_funding, date_last_funding, date_first_milestone, date_last_milestone)
category <- c("Foundation", "Funding", "Funding", "Milestone", "Milestone")
position <- c(0.05, 0.05, 0.05, 0.05, 0.05)
direction <- c(0.2, 0.2, 0.2, 0.2, 0.2)

start_up_timeline <- data.frame(milestone, date, category, position, direction)

start_up_timeline <- start_up_timeline %>%
  mutate(month = month(date),
         year = year(date))

```

```{r}
category_levels <- c("Foundation", "Funding", "Milestone")
category_colors <- c("#1f6e8c", "#ff5828", "#4aaec0")

start_up_timeline$category <- factor(start_up_timeline$category, levels = category_levels, ordered = TRUE)
```

```{r}
text_offset <- 0.05

start_up_timeline$month_count <- ave(start_up_timeline$date == start_up_timeline$date, 
                                     start_up_timeline$date, 
                                     FUN = cumsum)
start_up_timeline$text_position <- (start_up_timeline$month_count * text_offset * start_up_timeline$direction) + start_up_timeline$position
```

```{r}
month_buffer <- 2

month_date_range <- seq(min(start_up_timeline$date) - months(month_buffer), max(start_up_timeline$date) + months(month_buffer), by = "month")
month_format <- format(month_date_range, "%b")
month_df <- data.frame(month_date_range, month_format)
```

```{r}
year_date_range <- seq(min(start_up_timeline$date) - 
                         months(month_buffer), max(start_up_timeline$date) + 
                         months(month_buffer), by = "year")

year_date_range <- as.Date(
  intersect(
        ceiling_date(year_date_range, unit = "year"),
        floor_date(year_date_range, unit = "year")),  
    origin = "1970-01-01")

year_format <- format(year_date_range, '%Y')
year_df <- data.frame(year_date_range, year_format)
```

```{r, fig.width = 5, fig.height = 2}
# plotting the timeline
timeline_plot<-ggplot(start_up_timeline, 
                      aes(x = date,y = 0, col = category, label = milestone)) +
  scale_color_manual(values = category_colors, labels = category_levels, drop = FALSE) +
  theme_classic() +
  geom_hline(yintercept = 0, color = "black", size = 0.3) +
  geom_segment(data = start_up_timeline[start_up_timeline$month_count == 1,], 
               aes(y = position,yend = 0, xend = date),
               color='black', size=0.2) +
  geom_point(aes(y = 0), size = 3) +
  theme(axis.line.y = element_blank(),
        axis.text.y = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.line.x = element_blank(),
        legend.position = "bottom") +
  geom_text(data = month_df, 
            aes(x = month_date_range, y = -0.01, label = month_format),
            size = 2.5, vjust = 0.5, color = 'black', angle = 90) + 
  geom_text(data = year_df, 
            aes(x = year_date_range, y = -0.03, label = year_format, fontface = "bold"),
            size = 4, color = 'black') +
  geom_text(aes(y = text_position, label = milestone, fontface = "bold"),size = 2.5) +
  labs(title = "When should we aim to reach our milestones and funding rounds?",
       subtitle = "Timeline for our start-up",
       col = "Milestones",
       y = "",
       x = "") +
  NULL

timeline_plot
```





# Prediction 
model: Predict a startup's future based on its current characteristics
data modelling to select the features that might influence startups funding and outcomes.
### Logistic regression to predict status
```{r}

startup_data_select <- startup_data %>%
  mutate(status = ifelse(status == "acquired", 1, 0))

```

```{r}
# we select only the relevant variables
set.seed(1212)

train_test_split <- initial_split(startup_data_select, prop = 0.8) #training set contains 80% of the data

# Create the training and testing datasets
training <- training(train_test_split)
testing <- testing(train_test_split)
```

just playing around with the model (will tune further if necessary)
```{r}


status_logreg <- glm(status ~ 
                           avg_participants + 
                           age_first_milestone_year + 
                           age_last_milestone_year + 
                           year_founded +
                           relationships + 
                           funding_rounds +
                           log(funding_total_usd) +
                           is_mobile +
                           is_ca +
                           milestones, data = training, family = "binomial")
summary(status_logreg)
```



# try with LASSO maybe?





